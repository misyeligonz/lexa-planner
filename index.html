<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0f3d6e">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon-192.png" sizes="192x192">
  <title>Lexa Planner ‚Äî Deep Blue ¬∑ Soft Gray</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --deep-blue:#0f3d6e; --deep-blue-600:#134a88; --soft-gray:#f4f6f8;
      --ink:#1d2430; --muted:#6b7280; --card:#ffffff; --border:#d5dbe3;
      --danger:#d9685b; --radius:18px;
      --shadow:0 8px 24px rgba(15,61,110,.08), 0 2px 6px rgba(15,61,110,.05);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans";
      color:var(--ink);background:linear-gradient(180deg,var(--soft-gray),#fff 60%)}
    .app{max-width:960px;margin:0 auto;padding:24px; padding-bottom:120px;}
    header{display:flex;align-items:center;gap:14px;margin-bottom:12px;padding:12px 0 4px}
    .logo{width:40px;height:40px;border-radius:12px;background:radial-gradient(100% 100% at 30% 20%, #7fc1ff 0, #4f9fe0 40%, var(--deep-blue) 100%);box-shadow:inset 0 0 0 2px rgba(255,255,255,.25)}
    h1{font-size:20px;margin:0;letter-spacing:.3px}
    .subtitle{color:var(--muted);font-size:13px}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .toolbar-top{display:flex;justify-content:space-between;align-items:center;padding:10px 12px}
    .btn{appearance:none;border:none;border-radius:14px;padding:10px 14px;font-weight:600;letter-spacing:.2px;cursor:pointer;background:var(--deep-blue);color:#fff;box-shadow:0 2px 0 rgba(0,0,0,.06)}
    .btn.secondary{background:#eef3f8;color:var(--deep-blue);border:1px solid var(--border)}
    .btn.ghost{background:transparent;color:var(--deep-blue);border:1px dashed var(--border)}
    .btn:active{transform:translateY(1px)}
    .input-area{padding:12px}
    textarea{width:100%;min-height:160px;resize:vertical;border-radius:14px;border:1px solid var(--border);padding:14px;background:#fbfcfe;outline:none;box-shadow:inset 0 1px 0 #fff;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    textarea::placeholder{color:#9aa6b2}
    .timeline{position:relative;padding:18px 10px}
    .timeline:before{content:"";position:absolute;left:44px;top:0;bottom:0;width:2px;background:linear-gradient(var(--border),#cfd6df)}
    .card{position:relative;display:grid;grid-template-columns:110px 1fr;gap:12px;padding:12px;margin:8px 0 14px;background:var(--card);border:1px solid var(--border);border-left:6px solid var(--deep-blue);border-radius:14px;box-shadow:var(--shadow)}
    .card.done{opacity:.6} .card .title.done{text-decoration:line-through}
    .time{font-weight:700;color:var(--deep-blue-600);font-family:'JetBrains Mono','Roboto Mono','Courier New',monospace;font-variant-numeric:tabular-nums;font-feature-settings:"tnum" 1,"zero" 1;letter-spacing:.2px}
    .title{font-weight:700;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .meta{color:var(--muted);font-size:13px;margin-top:4px}
    .dot{position:absolute;left:41px;top:18px;width:12px;height:12px;background:#fff;border:2px solid var(--deep-blue);border-radius:50%}
    .actions{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
    .action{font-size:12px;padding:6px 10px;border-radius:10px;border:1px solid var(--border);background:#f8fbff;color:#0f3d6e;cursor:pointer}
    .action:active{transform:translateY(1px)}
    .subtasks{margin:8px 0 0;padding:0;list-style:none}
    .subtasks li{display:flex;align-items:flex-start;gap:8px;margin:4px 0}
    .subtasks input[type="checkbox"]{margin-top:2px}
    .subtasks .st-done{text-decoration:line-through;color:var(--muted)}

    /* Bottom toolbar */
    .toolbar-bottom{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid var(--border);box-shadow:0 -6px 24px rgba(15,61,110,.05);padding:8px 12px}
    .toolbar-bottom .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center}
    .toolbar-bottom .row2{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center}
    .date-input{border:1px solid var(--border);border-radius:12px;padding:8px 10px;background:#fbfcfe}
    @media print{.toolbar-top,.toolbar-bottom,.input-area,textarea,.actions{display:none!important}body{background:#fff}.app{max-width:800px}.panel{box-shadow:none}}

    /* üîë Login Toolbar */
    .auth-toolbar {
      position: absolute;
      top: 15px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .auth-toolbar button {
      font-size: 13px;
      padding: 5px 10px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: #f8fbff;
      color: #0f3d6e;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="logo" aria-hidden="true"></div>
  <h1>Lexa Planner</h1>
  <div class="subtitle">Deep Blue ¬∑ Soft Gray ‚Äî v3.2.0</div>

  <!-- Auth toolbar -->
  <div class="auth-toolbar">
    <button id="loginBtn">üîë Login with Google</button>
    <button id="logoutBtn" style="display:none;">üö™ Logout</button>
    <span id="userInfo" style="margin-left:10px; font-size:14px; color:#555;"></span>
  </div>

  <div class="app">
    <header></header>
    <div class="grid">
      <!-- Top panel -->
      <section class="panel">
        <div class="toolbar-top">
          <div style="font-weight:700; color:var(--deep-blue-600)">Today</div>
          <div style="display:flex; gap:8px; align-items:center">
            <button class="btn secondary" id="copyBtn">Copy</button>
            <button class="btn secondary" id="pdfBtn">PDF</button>
            <div id="summary" class="meta"></div>
          </div>
        </div>
        <div id="timeline" class="timeline">
          <div class="empty">Your planner will appear here.</div>
        </div>
      </section>

      <!-- Input panel -->
      <section class="panel">
        <div class="input-area">
          <textarea id="raw" placeholder="Paste time blocks, one per line.
Use semicolons ‚Äú;‚Äù for subtasks, e.g.
09:30‚Äì10:15 Warm-up Admin ‚Äî 1 invoice; demand letter; skim inbox
Optional: [Category], @location at end, #tags anywhere."></textarea>
          <div class="subtitle" style="padding:8px 12px 14px">Tip: You can mix 12-hour or 24-hour times, and use -, ‚Äì, ‚Äî, or ‚Äúto‚Äù.</div>
        </div>
      </section>
    </div>
  </div>

  <!-- Bottom toolbar -->
  <div class="toolbar-bottom">
    <div class="row">
      <button class="btn" id="renderBtn">Render</button>
      <button class="btn secondary" id="sampleBtn">Sample</button>
      <button class="btn ghost" id="clearBtn">Clear</button>
      <button class="btn secondary" id="saveBtn">Save (Cloud)</button>
      <button class="btn secondary" id="loadYBtn">Load Yesterday</button>
    </div>
    <div class="row2">
      <input type="date" id="datePicker" class="date-input">
      <button class="btn secondary" id="todayBtn">Today</button>
    </div>
  </div>

  <!-- Main Planner Script -->
  <script>
  (function (){
    const $ = (id)=>document.getElementById(id);
    const STORAGE_PREFIX = 'lexa:plan:';
    function toISODate(d){ const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), dd=String(d.getDate()).padStart(2,'0'); return `${y}-${m}-${dd}`; }
    function todayKey(){ return toISODate(new Date()); }
    function addDays(iso, delta){ const d=new Date(iso); d.setDate(d.getDate()+delta); return toISODate(d); }
    function kRaw(iso){ return `${STORAGE_PREFIX}${iso}:raw`; }
    function saveRawText(iso, t){ localStorage.setItem(kRaw(iso), t); }
    function loadRawText(iso){ return localStorage.getItem(kRaw(iso)) || ''; }

    let items = [], originalLines = [], selectedISO = todayKey();

    function render(lines){
      originalLines = lines.slice();
      items = [];
      lines.forEach((raw,i)=>{ if(raw.trim()){ items.push({lineIndex:i,title:raw}); }});
      const host = $('timeline'); host.innerHTML='';
      if(!items.length){ host.innerHTML='<div class="empty">Nothing to show. Paste blocks and tap <b>Render</b>.</div>'; $('summary').textContent=''; return; }
      $('summary').textContent = `${items.length} block${items.length>1?'s':''}`;
      items.forEach(it=>{
        const card=document.createElement('div'); card.className='card'; card.innerHTML=`<span class="dot"></span><div class="time">Block</div><div><div class="title">${it.title}</div></div>`;
        host.appendChild(card);
      });
    }

    window.addEventListener('load', ()=>{
      $('renderBtn').addEventListener('click', ()=>{ const raw=$('raw').value; saveRawText(selectedISO,raw); render(raw.split(/\n+/)); });
      $('sampleBtn').addEventListener('click', ()=>{ $('raw').value="08:30-09:15 Client conf.\n09:30-10:00 Team standup"; });
      $('clearBtn').addEventListener('click', ()=>{ $('raw').value=''; $('timeline').innerHTML='<div class="empty">Your planner will appear here.</div>'; localStorage.removeItem(kRaw(selectedISO)); });
      $('saveBtn').addEventListener('click', async ()=>{
        const raw=$('raw').value;
        saveRawText(selectedISO,raw);
        if(window.lexaFirebase?.auth.currentUser){
          const {db,doc,setDoc,auth}=window.lexaFirebase;
          await setDoc(doc(db,"users",auth.currentUser.uid,"plans",selectedISO),{raw});
          alert("Saved to cloud!");
        } else alert("Login required for cloud save.");
      });
      $('loadYBtn').addEventListener('click', async ()=>{
        const yISO=addDays(selectedISO,-1);
        let yRaw=loadRawText(yISO);
        if(window.lexaFirebase?.auth.currentUser){
          const {db,doc,getDoc,auth}=window.lexaFirebase;
          const snap=await getDoc(doc(db,"users",auth.currentUser.uid,"plans",yISO));
          if(snap.exists()) yRaw=snap.data().raw||yRaw;
        }
        if(!yRaw){ alert("No plan found."); return; }
        $('raw').value=yRaw; render(yRaw.split(/\n+/));
      });
      $('todayBtn').addEventListener('click', ()=>{ selectedISO=todayKey(); const raw=loadRawText(selectedISO); $('raw').value=raw; if(raw)render(raw.split(/\n+/)); });
      $('datePicker').addEventListener('change',async (e)=>{ if(!e.target.value)return; selectedISO=e.target.value; let raw=loadRawText(selectedISO); if(window.lexaFirebase?.auth.currentUser){ const {db,doc,getDoc,auth}=window.lexaFirebase; const snap=await getDoc(doc(db,"users",auth.currentUser.uid,"plans",selectedISO)); if(snap.exists()) raw=snap.data().raw||raw; } $('raw').value=raw; if(raw)render(raw.split(/\n+/)); });
    });
  })();
  </script>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "lexa-planner.firebaseapp.com",
      projectId: "lexa-planner",
      storageBucket: "lexa-planner.appspot.com",
      messagingSenderId: "328611098033",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.lexaFirebase = { app, auth, db, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut, doc, setDoc, getDoc };

    const loginBtn=document.getElementById("loginBtn");
    const logoutBtn=document.getElementById("logoutBtn");
    const userInfo=document.getElementById("userInfo");

    loginBtn.addEventListener("click",async()=>{
      try{const provider=new GoogleAuthProvider();await signInWithPopup(auth,provider);}catch(e){alert(e.message);}
    });
    logoutBtn.addEventListener("click",()=>signOut(auth));

    onAuthStateChanged(auth,(user)=>{
      if(user){ loginBtn.style.display="none"; logoutBtn.style.display="inline"; userInfo.textContent=user.email; }
      else{ loginBtn.style.display="inline"; logoutBtn.style.display="none"; userInfo.textContent=""; }
    });
  </script>
</body>
</html>
